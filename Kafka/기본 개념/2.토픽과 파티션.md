### 2. 토픽과 파티션

- **토픽과 파티션**
    
    토픽은 카프카에서 데이터를 구분하기 위해 사용하는 단위이다
    
    토픽은 1개 이상의 파티션을 소유하고 있다.파티션에는 프로듀서가 보낸 데이터들이 들어가 저장되는데 이 데이터를 **레코드**라고 한다.
    
    ![Untitled](https://github.com/seonwoojh/img-source/blob/main/img/%ED%86%A0%ED%94%BD%EA%B3%BC%20%ED%8C%8C%ED%8B%B0%EC%85%98.png?raw=true)
    
    파티션은 카프카의 병렬처리의 핵심으로써 그룹으로 묶인 컨슈머들이 레코드를 병렬로 처리할 수 있도록 매칭됨.
    
    **컨슈머의 처리량이 한정된 상황에서 많은 레코드를 병렬로 처리하는 가장 좋은 방법은 컨슈머의 갯수를 늘려 스케일 아웃을 하는것이다.** 
    
    컨슈머 개수를 늘림과 동시에 파티션 개수도 늘리면 처리량이 증가하는 효과를 볼 수 있다.
    
    파티션은 자료구조에서 접하는 큐(queue)와 비슷한 구조라고 생각하면 쉽다. FIFO 구조와 같이 먼저 들어간 레코드는 컨슈머가 먼저 가져가게 된다. 다만 일반적인 자료구조로 사용되는 큐는 **POP을 하게 되면 레코드를 삭제하지만 카프카에서는 삭제하지 않는다.**


- **적정 파티션 개수**

    토픽의 파티션 개수는 카프카의 성능과 관련이 있다. 토픽을 운영함에 있어 적절한 파티션 개수를 설정하고 운영하는 것이 매우 중요하다. 
    
    < 토픽 생성 시 파티션 개수 고려사항 >
    1. 데이터 처리량
    2. 메시지 키 사용 여부
    3. 브로커, 컨슈머 영향도
    
    파티션은 카프카의 병렬처리의 핵심이다. 파티션의 개수가 많아지면 많아질수록 1:1 매핑되는 컨슈머 개수가 늘어나기 때문이다. 그렇기 때문에 파티션 개수를 정할 때는 해당 토픽에 필요한 데이터 처리량을 측정하여 정하는 것이 중요하다.
    
    데이터 처리 속도를 올리는 방법은 컨슈머의 처리량을 늘리거나 컨슈머를 추가해서 병렬처리량을 늘리는 것이다. 컨슈머의 처리량을 늘리기 위해 컨슈머가 실행되는 서버를 스케일업 하거나 GC 튜닝 등을 활용할 수 있다. 그러나 컨슈머 특성상 다른 시스템(S3, 하둡, 오라클)과 연동되기 때문에 일정 수준 이상 처리량을 올리는 것은 매우 어렵다.
    
    반면 파티션 개수를 늘리고 파티션 개수만큼 컨슈머를 추가하는 방법은 데이터 처리량을 늘리는 가장 확실한 방법이다. 그러므로 프로듀서가 보내는 데이터양과 컨슈머의 데이터 처리량을 계산해서 파티션 개수를 정하면 된다. 만약 프로듀서가 보내는 데이터가 초당 1000 레코드이고 컨슈머가 처리할 수 있는 데이터가 초당 100레코드라면 최소한으로 필요한 파티션 개수는 10개다.
    
    **프로듀서 전송 데이터 량** < **컨슈머 데이터 처리량** X **파티션 개수**
    
